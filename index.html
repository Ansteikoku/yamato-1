<!DOCTYPE html>
<html lang="ja">
<head><meta charset="UTF-8"><title>ã‚¹ãƒ¬ä¸€è¦§</title><link rel="stylesheet" href="style.css"></head>
<body>
<h1>ğŸŒ¿ ã‚ã‹ãã•æ²ç¤ºæ¿</h1>
<a href="boards.html">â† æ¿ä¸€è¦§ã¸</a><div id="thread-list"></div>
<h2>ğŸ“ ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ</h2>
<form id="f">
  <input type="text" id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" required><br>
  <input type="text" id="name" placeholder="åå‰"><br>
  <textarea id="content" placeholder="æœ¬æ–‡" required></textarea><br>
  <button type="submit">ä½œæˆ</button>
</form>
<script type="module">
  import { supabase, escapeHtml } from './main.js';
  const params = new URLSearchParams(location.search);
  const board = params.get('board');
  const div = document.getElementById('thread-list');
  if (!board) return div.innerHTML = 'æ¿ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
  async function load() {
    const { data } = await supabase.from('threads')
      .select('id, title, name, created_at, comments(count)')
      .eq('board', board).order('created_at', { ascending: false });
    div.innerHTML = `<h2>ğŸ“‹ ${escapeHtml(board)} ã®ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§</h2><ul id="threads">` +
      data.map(t =>
        `<li><a href="thread.html?thread_id=${t.id}">[${escapeHtml(t.title)}]ï¼ˆ${t.comments[0]?.count||0}ãƒ¬ã‚¹ï¼‰</a> - ${escapeHtml(t.name||'åç„¡ã—')}</li>`
      ).join('') + '</ul>';
    document.title = board + ' - ã‚ã‹ãã•æ²ç¤ºæ¿';
  }
  load();
  document.getElementById('f').addEventListener('submit', async e => {
    e.preventDefault();
    const title = document.getElementById('title').value.trim();
    const name = document.getElementById('name').value.trim()||'åç„¡ã—';
    const content = document.getElementById('content').value.trim();
    await supabase.from('threads').insert({ board, title, name, content });
    document.getElementById('content').value='';
    load();
  });
</script>
</body>
</html>